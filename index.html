<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸‚åœºè¿½è¸ªçœ‹æ¿ - Market Watchlist</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            line-height: 1.4;
            font-size: 13px;
        }
        .header {
            background: #000;
            color: #fff;
            padding: 15px 20px;
            border-bottom: 3px solid #FFB800;
        }
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .header h1 {
            font-size: 24px;
            font-weight: 700;
            color: #fff;
            letter-spacing: 1px;
        }
        .header-meta {
            display: flex;
            gap: 20px;
            font-size: 12px;
            color: #888;
        }
        .header-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .refresh-btn {
            background: #FFB800;
            color: #000;
            border: none;
            padding: 6px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }
        .refresh-btn:hover {
            background: #ffcc00;
        }
        .container {
            max-width: 100%;
            padding: 0;
        }
        .section {
            margin-bottom: 2px;
            background: #141414;
        }
        .section-header {
            background: linear-gradient(90deg, #FFB800 0%, #FF9500 100%);
            color: #000;
            padding: 8px 15px;
            font-weight: 700;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        th {
            background: #1a1a1a;
            padding: 10px 8px;
            text-align: left;
            font-size: 11px;
            font-weight: 600;
            color: #888;
            border-bottom: 1px solid #333;
            white-space: nowrap;
        }
        th:last-child { text-align: right; }
        td {
            padding: 8px;
            border-bottom: 1px solid #222;
            vertical-align: middle;
        }
        tr:hover { background: #1a1a1a; }
        .ticker {
            font-weight: 700;
            color: #fff;
            font-size: 13px;
        }
        .name {
            color: #888;
            font-size: 11px;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .price {
            font-weight: 600;
            font-family: 'Courier New', monospace;
            color: #fff;
            font-size: 13px;
        }
        .change {
            font-weight: 600;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .positive { color: #00d084; }
        .negative { color: #ff4757; }
        .neutral { color: #888; }
        .sparkline { width: 60px; height: 25px; }
        .ytd {
            text-align: right;
            font-weight: 600;
            font-family: 'Courier New', monospace;
            padding-right: 10px;
            font-size: 12px;
        }
        .loading {
            text-align: center;
            padding: 100px 20px;
            color: #666;
        }
        .loading-spinner {
            border: 3px solid #333;
            border-top: 3px solid #FFB800;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error {
            text-align: center;
            padding: 100px 20px;
            color: #ff4757;
        }
        .footer {
            text-align: center;
            padding: 20px;
            color: #555;
            font-size: 11px;
            background: #000;
            border-top: 1px solid #222;
        }
        @media (max-width: 768px) {
            .header h1 { font-size: 18px; }
            .header-meta { font-size: 10px; gap: 10px; }
            th, td { padding: 6px 4px; font-size: 11px; }
            .sparkline { width: 50px; height: 20px; }
            .name { max-width: 100px; font-size: 10px; }
            .ticker { font-size: 12px; }
            .price { font-size: 12px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-top">
            <h1>ğŸ“Š MARKET WATCHLIST</h1>
            <button class="refresh-btn" onclick="fetchData()">ğŸ”„ åˆ·æ–°</button>
        </div>
        <div class="header-meta">
            <span>ğŸ“… <span id="currentDate">--</span></span>
            <span>â±ï¸ æ›´æ–°: <span id="lastUpdate">--</span></span>
            <span>ğŸ“ˆ æ•°æ®æº: Yahoo Finance / Stooq</span>
        </div>
    </div>
    
    <div class="container" id="container">
        <div class="loading">
            <div class="loading-spinner"></div>
            <div>æ­£åœ¨åŠ è½½å¸‚åœºæ•°æ®...</div>
        </div>
    </div>

    <div class="footer">
        <div> Market Watchlist Â© 2026 | ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®</div>
    </div>

    <script>
        // ETF é…ç½®
        const etfConfig = {
            'å…¨çƒå¸‚åœº': ['ACWI', 'VT', 'ACWX'],
            'ç¾å›½å¸‚åœº': ['VTI', 'SPY', 'QQQ'],
            'å•†å“ETF': ['GLD', 'SLV', 'PPLT', 'PALL', 'DBC', 'GSG', 'GCC'],
            'å‘è¾¾å¸‚åœº': ['EFA', 'EZU', 'EWU', 'EWG', 'EWQ', 'EWI', 'EWP', 'EWC', 'EWJ'],
            'æ–°å…´å¸‚åœº': ['EEM', 'EMXC', 'EWY', 'EWS', 'EIDO', 'EZA', 'EWM', 'INDA', 'ARGT', 'VNM', 'EWW', 'EWZ', 'EWT'],
            'ä¸­å›½å¸‚åœº': ['MCHI', 'FXI', 'KWEB', 'ASHR'],
            'è´µé‡‘å±ç°è´§': ['XAU', 'XAG', 'XPT', 'XPD'],
            'å·¥ä¸šé‡‘å±': ['COPPER', 'ALUMINUM'],
            'èƒ½æº': ['WTI', 'BRENT', 'NATGAS'],
            'åŠ å¯†è´§å¸': ['BTC', 'ETH', 'SOL'],
            'å®è§‚æŒ‡æ ‡': ['VIX', 'DXY', 'US10Y', 'US02Y', 'US30Y', 'T10Y2Y', 'HY_OAS']
        };

        const etfNames = {
            'ACWI': 'MSCIå…¨çƒETF', 'VT': 'å…ˆé”‹å…¨çƒè‚¡ç¥¨ETF', 'ACWX': 'MSCIå…¨çƒ(é™¤ç¾)ETF',
            'VTI': 'å…ˆé”‹å…¨ç¾è‚¡ç¥¨ETF', 'SPY': 'æ ‡æ™®500ETF', 'QQQ': 'çº³æ–¯è¾¾å…‹100ETF',
            'GLD': 'SPDRé»„é‡‘ETF', 'SLV': 'iSharesç™½é“¶ETF', 'PPLT': 'é“‚é‡‘ETF', 'PALL': 'é’¯é‡‘ETF',
            'DBC': 'å¾·é“¶å•†å“æŒ‡æ•°ETF', 'GSG': 'iSharesæ ‡æ™®é«˜ç››å•†å“ETF', 'GCC': 'GreenHavenè¿ç»­å•†å“ETF',
            'EFA': 'MSCIæ¬§æ¾³è¿œä¸œETF', 'EZU': 'MSCIæ¬§å…ƒåŒºETF', 'EWU': 'MSCIè‹±å›½ETF',
            'EWG': 'MSCIå¾·å›½ETF', 'EWQ': 'MSCIæ³•å›½ETF', 'EWI': 'MSCIæ„å¤§åˆ©ETF',
            'EWP': 'MSCIè¥¿ç­ç‰™ETF', 'EWC': 'MSCIåŠ æ‹¿å¤§ETF', 'EWJ': 'MSCIæ—¥æœ¬ETF',
            'EEM': 'MSCIæ–°å…´å¸‚åœºETF', 'EMXC': 'æ–°å…´å¸‚åœº(é™¤ä¸­)ETF', 'EWY': 'MSCIéŸ©å›½ETF',
            'EWS': 'MSCIæ–°åŠ å¡ETF', 'EIDO': 'MSCIå°å°¼ETF', 'EZA': 'MSCIå—éETF',
            'EWM': 'MSCIé©¬æ¥è¥¿äºšETF', 'INDA': 'MSCIå°åº¦ETF', 'ARGT': 'MSCIé˜¿æ ¹å»·ETF',
            'VNM': 'è¶Šå—ETF', 'EWW': 'MSCIå¢¨è¥¿å“¥ETF', 'EWZ': 'MSCIå·´è¥¿ETF', 'EWT': 'MSCIå°æ¹¾ETF',
            'MCHI': 'MSCIä¸­å›½ETF', 'FXI': 'ä¸­å›½å¤§ç›˜è‚¡ETF', 'KWEB': 'ä¸­å›½æµ·å¤–äº’è”ç½‘ETF', 'ASHR': 'æ²ªæ·±300ETF',
            'XAU': 'ç°è´§é»„é‡‘', 'XAG': 'ç°è´§ç™½é“¶', 'XPT': 'ç°è´§é“‚é‡‘', 'XPD': 'ç°è´§é’¯é‡‘',
            'COPPER': 'é“œæœŸè´§', 'ALUMINUM': 'é“æœŸè´§',
            'WTI': 'WTIåŸæ²¹', 'BRENT': 'å¸ƒä¼¦ç‰¹åŸæ²¹', 'NATGAS': 'å¤©ç„¶æ°”',
            'BTC': 'æ¯”ç‰¹å¸', 'ETH': 'ä»¥å¤ªåŠ', 'SOL': 'Solana',
            'VIX': 'ææ…ŒæŒ‡æ•°', 'DXY': 'ç¾å…ƒæŒ‡æ•°', 'US10Y': 'ç¾å›½10å¹´æœŸå›½å€º',
            'US02Y': 'ç¾å›½2å¹´æœŸå›½å€º', 'US30Y': 'ç¾å›½30å¹´æœŸå›½å€º',
            'T10Y2Y': 'ç¾å€º10Y-2Yåˆ©å·®', 'HY_OAS': 'é«˜æ”¶ç›Šå€ºåˆ©å·®'
        };

        async function fetchData() {
            const container = document.getElementById('container');
            container.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div>æ­£åœ¨åŠ è½½å¸‚åœºæ•°æ®...</div>
                </div>
            `;

            try {
                const response = await fetch('/api/data');
                const data = await response.json();
                
                if (data.error) throw new Error(data.error);
                
                currentData = data;
                renderTable();
                
                document.getElementById('currentDate').textContent = new Date().toLocaleDateString('zh-CN');
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('zh-CN');
            } catch (error) {
                container.innerHTML = `
                    <div class="error">
                        âŒ æ•°æ®åŠ è½½å¤±è´¥<br>
                        <small>${error.message}</small>
                    </div>
                `;
            }
        }

        function renderTable() {
            const container = document.getElementById('container');
            let html = '';

            for (const [section, tickers] of Object.entries(etfConfig)) {
                html += `
                    <div class="section">
                        <div class="section-header">${section}</div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ä»£ç </th>
                                    <th>åç§°</th>
                                    <th>ä»·æ ¼</th>
                                    <th>1D%</th>
                                    <th>50D%</th>
                                    <th>REL5</th>
                                    <th>REL20</th>
                                    <th>è¶‹åŠ¿</th>
                                    <th style="text-align:right">YTD%</th>
                                </tr>
                            </thead>
                            <tbody>`;

                for (const ticker of tickers) {
                    const d = currentData[ticker] || {};
                    const price = d.price || 0;
                    const change1d = d.change1d || 0;
                    const change50d = d.change50d || 0;
                    const rel5 = d.rel5 || 0;
                    const rel20 = d.rel20 || 0;
                    const ytd = d.ytd || 0;

                    const priceStr = price >= 1000 ? price.toFixed(2) : price >= 1 ? price.toFixed(2) : price.toFixed(4);

                    html += `
                        <tr>
                            <td class="ticker">${ticker}</td>
                            <td class="name">${etfNames[ticker] || ''}</td>
                            <td class="price">${priceStr}</td>
                            <td class="change ${change1d >= 0 ? 'positive' : 'negative'}">${change1d >= 0 ? '+' : ''}${change1d.toFixed(2)}%</td>
                            <td class="change ${change50d >= 0 ? 'positive' : 'negative'}">${change50d >= 0 ? '+' : ''}${change50d.toFixed(2)}%</td>
                            <td class="change ${rel5 >= 0 ? 'positive' : 'negative'}">${rel5 >= 0 ? '+' : ''}${rel5.toFixed(2)}%</td>
                            <td class="change ${rel20 >= 0 ? 'positive' : 'negative'}">${rel20 >= 0 ? '+' : ''}${rel20.toFixed(2)}%</td>
                            <td>${generateSparkline(d.sparkline || [])}</td>
                            <td class="ytd ${ytd >= 0 ? 'positive' : 'negative'}">${ytd >= 0 ? '+' : ''}${ytd.toFixed(2)}%</td>
                        </tr>`;
                }

                html += '</tbody></table></div>';
            }

            container.innerHTML = html;
        }

        function generateSparkline(data) {
            if (!data || data.length < 2) return '';
            
            const width = 60;
            const height = 25;
            const min = Math.min(...data);
            const max = Math.max(...data);
            const range = max - min || 1;
            
            const points = data.map((value, index) => {
                const x = (index / (data.length - 1)) * width;
                const y = height - ((value - min) / range) * height;
                return `${x.toFixed(1)},${y.toFixed(1)}`;
            }).join(' ');
            
            const color = data[data.length - 1] >= data[0] ? '#00d084' : '#ff4757';
            
            return `<svg class="sparkline" viewBox="0 0 60 25">
                <polyline fill="none" stroke="${color}" stroke-width="1.5" points="${points}"/>
            </svg>`;
        }

        let currentData = {};
        fetchData();
        setInterval(fetchData, 60000);
    </script>
</body>
</html>
