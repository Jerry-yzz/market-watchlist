<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Watchlist - å…¨çƒå¸‚åœºè¿½è¸ª</title>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-header: #1a1a2e;
            --bg-section: #f0f0f0;
            --text-primary: #333;
            --text-secondary: #666;
            --text-muted: #888;
            --border-color: #e0e0e0;
            --accent: #FFB800;
            --positive: #28a745;
            --positive-bg: #d4edda;
            --negative: #dc3545;
            --negative-bg: #f8d7da;
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #0a0a0a;
                --bg-secondary: #141414;
                --bg-header: #000;
                --bg-section: #1a1a1a;
                --text-primary: #e0e0e0;
                --text-secondary: #aaa;
                --text-muted: #666;
                --border-color: #333;
                --accent: #FFB800;
                --positive: #00d084;
                --positive-bg: rgba(0,208,132,0.1);
                --negative: #ff4757;
                --negative-bg: rgba(255,71,87,0.1);
            }
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 12px;
            line-height: 1.4;
        }
        
        /* é¡¶éƒ¨æ ‡é¢˜åŒº */
        .main-header {
            background: var(--bg-header);
            color: #fff;
            padding: 15px 20px;
            border-bottom: 3px solid var(--accent);
        }
        
        .main-header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .header-desc {
            font-size: 13px;
            color: #aaa;
            line-height: 1.6;
            max-width: 900px;
        }
        
        .header-meta-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #333;
            font-size: 11px;
            color: #888;
        }
        
        .refresh-btn {
            background: var(--accent);
            color: #000;
            border: none;
            padding: 4px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
        }
        
        /* å†…å®¹åŒº */
        .container {
            padding: 0;
        }
        
        /* åˆ†ç»„æ ‡é¢˜ */
        .section {
            margin: 0;
            border-bottom: 2px solid var(--border-color);
        }
        
        .section-title {
            background: var(--accent);
            color: #000;
            padding: 6px 15px;
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .section-desc {
            background: var(--bg-section);
            padding: 8px 15px;
            font-size: 11px;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-color);
        }
        
        /* è¡¨æ ¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }
        
        th {
            background: var(--bg-secondary);
            padding: 8px 6px;
            text-align: left;
            font-size: 10px;
            font-weight: 600;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border-color);
            white-space: nowrap;
        }
        
        th:last-child { text-align: right; }
        
        td {
            padding: 6px;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }
        
        tr:hover { background: var(--bg-secondary); }
        
        .ticker {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 12px;
        }
        
        .name {
            color: var(--text-secondary);
            font-size: 10px;
            max-width: 180px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .price {
            font-weight: 600;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .change {
            font-weight: 600;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            padding: 2px 4px;
            border-radius: 2px;
        }
        
        .positive { 
            color: var(--positive); 
            background: var(--positive-bg);
        }
        
        .negative { 
            color: var(--negative); 
            background: var(--negative-bg);
        }
        
        .neutral {
            color: var(--text-muted);
        }
        
        .sparkline {
            width: 50px;
            height: 20px;
        }
        
        .ytd {
            text-align: right;
            font-weight: 600;
            font-family: 'Courier New', monospace;
            padding-right: 8px;
        }
        
        /* åº•éƒ¨è¯´æ˜ */
        .footer-note {
            background: var(--bg-secondary);
            padding: 15px;
            font-size: 10px;
            color: var(--text-muted);
            line-height: 1.6;
            border-top: 2px solid var(--border-color);
        }
        
        .footer-note strong {
            color: var(--text-primary);
        }
        
        /* åŠ è½½ */
        .loading {
            text-align: center;
            padding: 50px;
            color: var(--text-muted);
        }
        
        @media (max-width: 768px) {
            .main-header h1 { font-size: 20px; }
            .header-desc { font-size: 11px; }
            .section-title { font-size: 11px; }
            .name { max-width: 100px; }
            th, td { padding: 4px; font-size: 10px; }
        }
    </style>
</head>
<body>
    <div class="main-header">
        <h1>ğŸ“Š å…¨çƒå¸‚åœºè¿½è¸ªçœ‹æ¿</h1>
        <div class="header-desc">
            è·¨è¶Šåœ°åŸŸä¸èµ„äº§ç±»åˆ«çš„å…¨çƒå®è§‚è§†è§’ï¼Œå®æ—¶ç›‘æ§è‚¡ç¥¨ã€å•†å“ã€è´µé‡‘å±ã€èƒ½æºåŠåŠ å¯†è´§å¸ç­‰æ ¸å¿ƒèµ„äº§ã€‚
            é€šè¿‡å¤šç»´æ•°æ®äº¤å‰éªŒè¯ï¼Œå¿«é€Ÿè¯†åˆ«å¸‚åœºå¤„äº"é£é™©è¿½é€"æŠ‘æˆ–"é˜²å¾¡é¿é™©"çŠ¶æ€ï¼Œä¸ºèµ„äº§é…ç½®å†³ç­–æä¾›æ•°æ®æ”¯æ’‘ã€‚
        </div>
        <div class="header-meta-bar">
            <div>
                ğŸ“… <span id="currentDate">--</span> | 
                â±ï¸ æ›´æ–°: <span id="lastUpdate">--</span> | 
                ğŸ”„ è‡ªåŠ¨åˆ·æ–°: 60s
            </div>
            <button class="refresh-btn" onclick="fetchData()">åˆ·æ–°æ•°æ®</button>
        </div>
    </div>
    
    <div class="container" id="container">
        <div class="loading">æ­£åœ¨åŠ è½½å¸‚åœºæ•°æ®...</div>
    </div>

    <div class="footer-note">
        <strong>æ•°æ®è¯´æ˜:</strong> æ•°æ®æºä¸ºYahoo Financeå’ŒStooqï¼Œæ›´æ–°é¢‘ç‡çº¦15åˆ†é’Ÿå»¶è¿Ÿã€‚<br>
        REL5 = ç›¸å¯¹5æ—¥å‰æ¶¨è·Œå¹… | REL20 = ç›¸å¯¹20æ—¥å‰æ¶¨è·Œå¹… | YTD = å¹´åˆè‡³ä»Šæ¶¨è·Œå¹…<br>
        <strong>é£é™©æç¤º:</strong> æœ¬é¡µé¢ä»…ä¾›å­¦ä¹ äº¤æµï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚å¸‚åœºæœ‰é£é™©ï¼ŒæŠ•èµ„éœ€è°¨æ…ã€‚
    </div>

    <script>
        const sections = {
            'å…¨çƒå¸‚åœº': {
                desc: 'å…¨çƒè‚¡ç¥¨ã€è·¨åœ°åŸŸã€é™ç»´åº¦çš„èµ„äº§é…ç½®â€”â€”è¿™æ˜¯åœ°çƒè§†è§’çš„"ä¸€æ½å­æŠ¼æ³¨"',
                items: ['ACWI', 'VT', 'ACWX']
            },
            'ç¾å›½å¸‚åœº': {
                desc: 'ç¾è‚¡æ ¸å¿ƒèµ„äº§ï¼šå¤§ç›˜è“ç­¹ã€ç§‘æŠ€é¾™å¤´ã€å…¨å¸‚åœºæŒ‡æ•°åŸºé‡‘',
                items: ['VTI', 'SPY', 'QQQ']
            },
            'è´µé‡‘å±ETF': {
                desc: 'å®ç‰©æ”¯æŒçš„è´µé‡‘å±ETFï¼ŒæŠ—é€šèƒ€ã€é¿é™©é…ç½®çš„æ ¸å¿ƒå·¥å…·',
                items: ['GLD', 'SLV', 'PPLT', 'PALL', 'DBC', 'GSG', 'GCC']
            },
            'å‘è¾¾å¸‚åœº': {
                desc: 'æ¬§æ´²ã€æ—¥æœ¬ç­‰å‘è¾¾ç»æµä½“è‚¡ç¥¨æŒ‡æ•°',
                items: ['EFA', 'EZU', 'EWU', 'EWG', 'EWQ', 'EWI', 'EWP', 'EWC', 'EWJ']
            },
            'æ–°å…´å¸‚åœº': {
                desc: 'é«˜å¢é•¿æ½œåŠ›å¸‚åœºï¼šäºšæ´²ã€æ‹‰ç¾ã€éæ´²ç­‰å‘å±•ä¸­ç»æµä½“',
                items: ['EEM', 'EMXC', 'EWY', 'EWS', 'EIDO', 'EZA', 'EWM', 'INDA', 'ARGT', 'VNM', 'EWW', 'EWZ', 'EWT']
            },
            'ä¸­å›½å¸‚åœº': {
                desc: 'Aè‚¡ã€æ¸¯è‚¡ã€ä¸­æ¦‚è‚¡å…¨è¦†ç›–ï¼Œè·Ÿè¸ªä¸­å›½æ ¸å¿ƒèµ„äº§',
                items: ['MCHI', 'FXI', 'KWEB', 'ASHR']
            },
            'è´µé‡‘å±ç°è´§': {
                desc: 'é»„é‡‘ã€ç™½é“¶ç­‰è´µé‡‘å±ç°è´§ä»·æ ¼ï¼Œå…¨çƒé¿é™©èµ„äº§é£å‘æ ‡',
                items: ['XAU', 'XAG', 'XPT', 'XPD']
            },
            'å·¥ä¸šé‡‘å±': {
                desc: 'é“œã€é“ç­‰å·¥ä¸šåŸºç¡€é‡‘å±ï¼Œå…¨çƒç»æµæ´»åŠ¨æ™´é›¨è¡¨',
                items: ['COPPER', 'ALUMINUM']
            },
            'èƒ½æº': {
                desc: 'åŸæ²¹ã€å¤©ç„¶æ°”ç­‰èƒ½æºå•†å“ï¼Œåœ°ç¼˜æ”¿æ²»ä¸ä¾›éœ€åšå¼ˆåœº',
                items: ['WTI', 'BRENT', 'NATGAS']
            },
            'åŠ å¯†è´§å¸': {
                desc: 'æ•°å­—èµ„äº§æ–°çºªå…ƒï¼šBTCã€ETHç­‰ä¸»æµåŠ å¯†è´§å¸',
                items: ['BTC', 'ETH', 'SOL']
            },
            'å®è§‚æŒ‡æ ‡': {
                desc: 'VIXææ…ŒæŒ‡æ•°ã€ç¾å…ƒæŒ‡æ•°ã€ç¾å€ºæ”¶ç›Šç‡ç­‰å…³é”®å®è§‚é£å‘æ ‡',
                items: ['VIX', 'DXY', 'US10Y', 'US02Y', 'US30Y', 'T10Y2Y', 'HY_OAS']
            }
        };

        const etfNames = {
            'ACWI': 'MSCIå…¨çƒETF', 'VT': 'å…ˆé”‹å…¨çƒè‚¡ç¥¨ETF', 'ACWX': 'MSCIå…¨çƒ(é™¤ç¾)ETF',
            'VTI': 'å…ˆé”‹å…¨ç¾è‚¡ç¥¨ETF', 'SPY': 'æ ‡æ™®500ETF', 'QQQ': 'çº³æ–¯è¾¾å…‹100ETF',
            'GLD': 'SPDRé»„é‡‘ETF', 'SLV': 'iSharesç™½é“¶ETF', 'PPLT': 'é“‚é‡‘ETF', 'PALL': 'é’¯é‡‘ETF',
            'DBC': 'å¾·é“¶å•†å“æŒ‡æ•°ETF', 'GSG': 'iSharesæ ‡æ™®é«˜ç››å•†å“ETF', 'GCC': 'GreenHavenè¿ç»­å•†å“ETF',
            'EFA': 'MSCIæ¬§æ¾³è¿œä¸œETF', 'EZU': 'MSCIæ¬§å…ƒåŒºETF', 'EWU': 'MSCIè‹±å›½ETF',
            'EWG': 'MSCIå¾·å›½ETF', 'EWQ': 'MSCIæ³•å›½ETF', 'EWI': 'MSCIæ„å¤§åˆ©ETF',
            'EWP': 'MSCIè¥¿ç­ç‰™ETF', 'EWC': 'MSCIåŠ æ‹¿å¤§ETF', 'EWJ': 'MSCIæ—¥æœ¬ETF',
            'EEM': 'MSCIæ–°å…´å¸‚åœºETF', 'EMXC': 'æ–°å…´å¸‚åœº(é™¤ä¸­)ETF', 'EWY': 'MSCIéŸ©å›½ETF',
            'EWS': 'MSCIæ–°åŠ å¡ETF', 'EIDO': 'MSCIå°å°¼ETF', 'EZA': 'MSCIå—éETF',
            'EWM': 'MSCIé©¬æ¥è¥¿äºšETF', 'INDA': 'MSCIå°åº¦ETF', 'ARGT': 'MSCIé˜¿æ ¹å»·ETF',
            'VNM': 'è¶Šå—ETF', 'EWW': 'MSCIå¢¨è¥¿å“¥ETF', 'EWZ': 'MSCIå·´è¥¿ETF', 'EWT': 'MSCIå°æ¹¾ETF',
            'MCHI': 'MSCIä¸­å›½ETF', 'FXI': 'ä¸­å›½å¤§ç›˜è‚¡ETF', 'KWEB': 'ä¸­å›½æµ·å¤–äº’è”ç½‘ETF', 'ASHR': 'æ²ªæ·±300ETF',
            'XAU': 'ç°è´§é»„é‡‘', 'XAG': 'ç°è´§ç™½é“¶', 'XPT': 'ç°è´§é“‚é‡‘', 'XPD': 'ç°è´§é’¯é‡‘',
            'COPPER': 'é“œæœŸè´§', 'ALUMINUM': 'é“æœŸè´§',
            'WTI': 'WTIåŸæ²¹', 'BRENT': 'å¸ƒä¼¦ç‰¹åŸæ²¹', 'NATGAS': 'å¤©ç„¶æ°”',
            'BTC': 'æ¯”ç‰¹å¸', 'ETH': 'ä»¥å¤ªåŠ', 'SOL': 'Solana',
            'VIX': 'ææ…ŒæŒ‡æ•°', 'DXY': 'ç¾å…ƒæŒ‡æ•°', 'US10Y': 'ç¾å›½10å¹´æœŸå›½å€º',
            'US02Y': 'ç¾å›½2å¹´æœŸå›½å€º', 'US30Y': 'ç¾å›½30å¹´æœŸå›½å€º',
            'T10Y2Y': 'ç¾å€º10Y-2Yåˆ©å·®', 'HY_OAS': 'é«˜æ”¶ç›Šå€ºåˆ©å·®'
        };

        let currentData = {};

        async function fetchData() {
            document.getElementById('container').innerHTML = '<div class="loading">æ­£åœ¨åŠ è½½å¸‚åœºæ•°æ®...</div>';
            
            try {
                const response = await fetch('/api/data');
                const data = await response.json();
                if (data.error) throw new Error(data.error);
                
                currentData = data;
                renderTable();
                
                document.getElementById('currentDate').textContent = new Date().toLocaleDateString('zh-CN');
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('zh-CN');
            } catch (error) {
                document.getElementById('container').innerHTML = `<div class="loading" style="color:var(--negative)">åŠ è½½å¤±è´¥: ${error.message}</div>`;
            }
        }

        function renderTable() {
            let html = '';
            
            for (const [sectionName, sectionData] of Object.entries(sections)) {
                html += `
                    <div class="section">
                        <div class="section-title">${sectionName}</div>
                        <div class="section-desc">${sectionData.desc}</div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ä»£ç </th>
                                    <th>åç§°</th>
                                    <th>ä»·æ ¼</th>
                                    <th>1D%</th>
                                    <th>50D%</th>
                                    <th>REL5</th>
                                    <th>REL20</th>
                                    <th>Trend</th>
                                    <th style="text-align:right">YTD%</th>
                                </tr>
                            </thead>
                            <tbody>`;
                
                for (const ticker of sectionData.items) {
                    const d = currentData[ticker] || {};
                    const price = d.price || 0;
                    const change1d = d.change1d || 0;
                    const change50d = d.change50d || 0;
                    const rel5 = d.rel5 || 0;
                    const rel20 = d.rel20 || 0;
                    const ytd = d.ytd || 0;
                    
                    const priceStr = price >= 1000 ? price.toFixed(2) : price >= 1 ? price.toFixed(2) : price.toFixed(4);
                    
                    html += `
                        <tr>
                            <td class="ticker">${ticker}</td>
                            <td class="name">${etfNames[ticker] || ''}</td>
                            <td class="price">${priceStr}</td>
                            <td class="change ${change1d >= 0 ? 'positive' : 'negative'}">${change1d >= 0 ? '+' : ''}${change1d.toFixed(2)}%</td>
                            <td class="change ${change50d >= 0 ? 'positive' : 'negative'}">${change50d >= 0 ? '+' : ''}${change50d.toFixed(2)}%</td>
                            <td class="change ${rel5 >= 0 ? 'positive' : 'negative'}">${rel5 >= 0 ? '+' : ''}${rel5.toFixed(2)}%</td>
                            <td class="change ${rel20 >= 0 ? 'positive' : 'negative'}">${rel20 >= 0 ? '+' : ''}${rel20.toFixed(2)}%</td>
                            <td>${generateSparkline(d.sparkline || [])}</td>
                            <td class="ytd ${ytd >= 0 ? 'positive' : 'negative'}">${ytd >= 0 ? '+' : ''}${ytd.toFixed(2)}%</td>
                        </tr>`;
                }
                
                html += '</tbody></table></div>';
            }
            
            document.getElementById('container').innerHTML = html;
        }

        function generateSparkline(data) {
            if (!data || data.length < 2) return '';
            const width = 50, height = 20;
            const min = Math.min(...data), max = Math.max(...data);
            const range = max - min || 1;
            
            const points = data.map((v, i) => {
                const x = (i / (data.length - 1)) * width;
                const y = height - ((v - min) / range) * height;
                return `${x.toFixed(1)},${y.toFixed(1)}`;
            }).join(' ');
            
            const color = data[data.length - 1] >= data[0] ? 'var(--positive)' : 'var(--negative)';
            
            return `<svg class="sparkline" viewBox="0 0 50 20">
                <polyline fill="none" stroke="${color}" stroke-width="1.5" points="${points}"/>
            </svg>`;
        }

        fetchData();
        setInterval(fetchData, 60000);
    </script>
</body>
</html>
